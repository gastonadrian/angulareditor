var express = require('express');
var path = require('path');
var favicon = require('static-favicon');
var logger = require('morgan');
var cookieParser = require('cookie-parser');
var bodyParser = require('body-parser');

var routes = require('./routes/index');
var users = require('./routes/users');

var app = express();

// view engine setup
app.set('views', path.join(__dirname, 'views'));
app.set('view engine', 'jade');

app.use('/api/applications?', function(req, res, next){
    res.send({"AutoSaveFrecuency":180000,"TimeZone":"Eastern Standard Time","HasSocialMediaEnabled":false,"DefaultDesignId":4042,"TwitterPostMaxLength":117,"TwitterSocialMediaTypeId":3,"FacebookPostMaxLegnth":5000,"FacebookSocialMediaTypeId":2,"FoursquarePostMaxLength":138,"FoursquareSocialMediaTypeId":13,"SocialMediaPreviewLength":23,"IsFullSupportedClient":true,"AutoSpellCheck":false,"CouponCodeLabelText":" Coupon Code: "});
    res.end();
});

app.use('/api/designs', function(req, res, next){
    res.send({"PageIndex":0,"TotalRowCount":482,"Rows":[{"id":5225,"thumbnailUrl":"/Images/Designs/00005225/LargeThumbnail.jpg","description":null,"favorite":false,"name":"Tropical Sunset Yellow"},{"id":5224,"thumbnailUrl":"/Images/Designs/00005224/LargeThumbnail.jpg","description":null,"favorite":false,"name":"Tropical Sunset White"},{"id":5172,"thumbnailUrl":"/Images/Designs/00005172/LargeThumbnail.jpg","description":null,"favorite":false,"name":"Give Thanks Brown"},{"id":5171,"thumbnailUrl":"/Images/Designs/00005171/LargeThumbnail.jpg","description":null,"favorite":false,"name":"Give Thanks White"},{"id":5169,"thumbnailUrl":"/Images/Designs/00005169/LargeThumbnail.jpg","description":null,"favorite":false,"name":"Happy Hour Beige"},{"id":5168,"thumbnailUrl":"/Images/Designs/00005168/LargeThumbnail.jpg","description":null,"favorite":false,"name":"Happy Hour White"},{"id":5167,"thumbnailUrl":"/Images/Designs/00005167/LargeThumbnail.jpg","description":null,"favorite":false,"name":"Work Party Beige"},{"id":5166,"thumbnailUrl":"/Images/Designs/00005166/LargeThumbnail.jpg","description":null,"favorite":false,"name":"Work Party Red"},{"id":5151,"thumbnailUrl":"/Images/Designs/00005151/LargeThumbnail.jpg","description":null,"favorite":false,"name":"Pumpkins Blue"},{"id":5149,"thumbnailUrl":"/Images/Designs/00005149/LargeThumbnail.jpg","description":null,"favorite":false,"name":"Pumpkins White"},{"id":5145,"thumbnailUrl":"/Images/Designs/00005145/LargeThumbnail.jpg","description":null,"favorite":false,"name":"Late Night 3"},{"id":5144,"thumbnailUrl":"/Images/Designs/00005144/LargeThumbnail.jpg","description":null,"favorite":false,"name":"Late Night 2"},{"id":5143,"thumbnailUrl":"/Images/Designs/00005143/LargeThumbnail.jpg","description":null,"favorite":false,"name":"Late Night 1"},{"id":5135,"thumbnailUrl":"/Images/Designs/00005135/LargeThumbnail.jpg","description":null,"favorite":false,"name":"Kids Blue"},{"id":5134,"thumbnailUrl":"/Images/Designs/00005134/LargeThumbnail.jpg","description":null,"favorite":false,"name":"Kids White"},{"id":5133,"thumbnailUrl":"/Images/Designs/00005133/LargeThumbnail.jpg","description":null,"favorite":false,"name":"Kids Eat Free"},{"id":5123,"thumbnailUrl":"/Images/Designs/00005123/LargeThumbnail.jpg","description":null,"favorite":false,"name":"Halloween Orange"},{"id":5122,"thumbnailUrl":"/Images/Designs/00005122/LargeThumbnail.jpg","description":null,"favorite":false,"name":"Halloween White"},{"id":5121,"thumbnailUrl":"/Images/Designs/00005121/LargeThumbnail.jpg","description":null,"favorite":false,"name":"Happy Halloween"},{"id":5113,"thumbnailUrl":"/Images/Designs/00005113/LargeThumbnail.jpg","description":null,"favorite":false,"name":"Beer Tasting Beige"}]});
    res.end();
});

app.use('/api/designFolders', function(req, res, next){
   res.send([{"id":-2,"name":"All Designs","count":488},{"id":1,"name":"Designs for Images","count":21},{"id":2,"name":"Holidays","count":123},{"id":3,"name":"Loyalty Messages","count":40},{"id":4,"name":"Promos & Themes","count":57},{"id":5,"name":"Restaurant Type","count":149},{"id":6,"name":"Seasons","count":41},{"id":7,"name":"Sports","count":51}]);
    res.end();
});

app.use('/api/favoriteDesigns', function(req, res, next){
   res.send({});
   res.end();
});

app.use('/api/messages', function(req, res, next){
    console.log(req.method);
    var previewFalseCopyFalse = {"Id":57214,"DesignId":5225,"LayoutId":1,"Name":"test","Subject":null,"From":"Wilson","ReusableCouponCode":null,"HasRedeemContentBlock":false,"Html":"<html xmlns:Indy=\"urn:indy-scripts\"><head><META http-equiv=\"Content-Type\" content=\"text/html; charset=us-ascii\"></head><body bgcolor=\"#FFFFFF\">##Global.LocalHotmailCss##<div class=\"outerWrapper\" align=\"center\"><table width=\"600\"><tr><td style=\"font-size:11px;font-family:Verdana;padding-bottom:3px;text-align:right;\"><a style=\"color:#000000;\" href=\"##_onlineversion('StoreCode')_##\">View Online</a></td></tr></table><table width=\"600\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\"><tr><td><IMG SRC=\"/Images/Designs/00005225/1.jpg?e=1402087029\" ALT=\"\" WIDTH=\"600\" HEIGHT=\"175\" BORDER=\"0\"></td></tr><tr><td bgcolor=\"#FFDF96\" width=\"600\" height=\"20\" align=\"left\"><table width=\"95%\" align=\"center\" class=\"layoutTable\"><tbody><tr class=\"editorContentBlock\"><td style=\"padding-top: 10px; padding-bottom: 10px;\"><div editable=\"true\" class=\"editor-default-value align\" image-editor=\"true\" style=\"margin:0px auto;float:none;\"><img data-align-enabled=\"true\" width=\"560\" height=\"112\" data-file-width=\"776\" data-file-height=\"156\" data-file-id=\"0\" src=\"/Images/LayoutPreviews/imageblockdefault.jpg\" style=\"max-width:100%;\"></div></td></tr><tr class=\"editorContentBlock\"><td style=\"padding-top: 10px; padding-bottom: 10px;\"><table><tr><td><div editable=\"true\" class=\"editor-default-value imageEditorBlock\" image-editor=\"true\" style=\"float:left; zoom:1; width:184px; height:81px;padding-top:10px;\"><img vspace=\"10\" hspace=\"20\" width=\"184\" height=\"81\" data-file-width=\"184\" data-file-height=\"81\" data-file-id=\"0\" src=\"/Images/LayoutPreviews/imageblocksmalldefault.jpg\" align=\"left\"></div><div data-contenteditable=\"true\" editable=\"true\" class=\"editor-default-value\" text-editor=\"true\" style=\"font-family:Arial, Helvetica, sans-serif; font-size:11pt; \"><p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aliquam, magni natus voluptas vero sit nesciunt consequatur eveniet iure tempora ex! Quas iure mollitia aut aspernatur. Voluptas non harum reiciendis vel? Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci, nobis, at, accusamus cumque sit laboriosam non voluptatibus totam iste fugit earum harum nam voluptates officiis et laudantium rem dolorem minus!</p></div></td></tr></table></td></tr><tr class=\"editorContentBlock\"><td style=\"padding-top: 10px; padding-bottom: 10px;\"><table><tr><td><div editable=\"true\" class=\"editor-default-value imageEditorBlock\" image-editor=\"true\" style=\"float:left; zoom:1; width:184px; height:81px;padding-top:10px;\"><img vspace=\"10\" hspace=\"20\" width=\"184\" height=\"81\" data-file-width=\"184\" data-file-height=\"81\" data-file-id=\"0\" src=\"/Images/LayoutPreviews/imageblocksmalldefault.jpg\" align=\"left\"></div><div data-contenteditable=\"true\" editable=\"true\" class=\"editor-default-value\" text-editor=\"true\" style=\"font-family:Arial, Helvetica, sans-serif; font-size:11pt; \"><p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aliquam, magni natus voluptas vero sit nesciunt consequatur eveniet iure tempora ex! Quas iure mollitia aut aspernatur. Voluptas non harum reiciendis vel? Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci, nobis, at, accusamus cumque sit laboriosam non voluptatibus totam iste fugit earum harum nam voluptates officiis et laudantium rem dolorem minus!</p></div></td></tr></table></td></tr><tr class=\"editorContentBlock\"><td style=\"padding-top: 10px; padding-bottom: 10px;\"><table><tr><td><div editable=\"true\" class=\"editor-default-value imageEditorBlock\" image-editor=\"true\" style=\"float:left; zoom:1; width:184px; height:81px;padding-top:10px;\"><img vspace=\"10\" hspace=\"20\" width=\"184\" height=\"81\" data-file-width=\"184\" data-file-height=\"81\" data-file-id=\"0\" src=\"/Images/LayoutPreviews/imageblocksmalldefault.jpg\" align=\"left\"></div><div data-contenteditable=\"true\" editable=\"true\" class=\"editor-default-value\" text-editor=\"true\" style=\"font-family:Arial, Helvetica, sans-serif; font-size:11pt; \"><p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aliquam, magni natus voluptas vero sit nesciunt consequatur eveniet iure tempora ex! Quas iure mollitia aut aspernatur. Voluptas non harum reiciendis vel? Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci, nobis, at, accusamus cumque sit laboriosam non voluptatibus totam iste fugit earum harum nam voluptates officiis et laudantium rem dolorem minus!</p></div></td></tr></table></td></tr></tbody></table></td></tr><tr><td><IMG SRC=\"/Images/Designs/00005225/3.jpg?e=1402087029\" ALT=\"\" WIDTH=\"600\" HEIGHT=\"92\" BORDER=\"0\"></td></tr></table><table width=\"600\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\"><tr><td colspan=\"3\"><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\"><tr><td align=\"center\"></td><td></td></tr></table></td></tr><tr><td colspan=\"3\"><br><table width=\"100%\" border=\"0\"><tr><td align=\"center\" NOWRAP><style type=\"text/css\">\r\n                    a:link {color: #000000}     /* unvisited link */\r\n                    a:visited {color: #000000}  /* visited link */\r\n                    a:hover {color: #000000}   /* mouse over link */\r\n                    a:active {color: #000000}\r\n                </style>##Global.localUnsubLink## ##Global.localProfileLink## </td></tr><tr><td><hr noshade width=\"100%\" style=\"margin:0px\"></td></tr></table><table cellpadding=\"10\"><tr><td valign=\"top\"><img src=\"http://www.fishbowl.com/poweredby.gif\"></td><td align=\"left\"><DIV style=\"font-family:Arial, Helvetica, sans-serif; font-size:7pt; \">This email was sent because you joined our email club while visiting one of our establishments or through our website. Your email address will not be shared with anyone. You can take your name out of the email club at any time by clicking the unsubscribe link in this email and you will be removed from our list immediately. You joined our list using ##EmailAddress##. Roberto's Pizzeria Bar & Grill, 138 Fisherman's Cove, Miramar Beach, FL 32550 </DIV></td></tr></table></td></tr></table></div><style type=\"text/css\">\r\n                #outerWrapper a:link { color:Black;  } #outerWrapper a:visited {color:Black; } #outerWrapper a:hover { color:Black; } #outerWrapper a:active { color:Black; }\r\n            </style></body></html>","Date":null,"Time":null,"List":null,"GuestCodes":null,"Stores":null,"IncludePreviewInSocialMediaPost":false,"SocialMediaMessage":null,"SocialMediaAccounts":null,"SendNow":false,"CancelAvailable":false,"IsFinalized":false};
    var updateNoSchedule = {"Id":57214,"DesignId":5225,"LayoutId":1,"Name":"test","Subject":null,"From":"Wilson","ReusableCouponCode":null,"HasRedeemContentBlock":false,"Html":null,"Date":null,"Time":null,"List":{"Id":2147484317,"SiteId":2147484031,"Name":"General Mailings","Description":"General Mailings","Default":true,"MemberCount":0},"GuestCodes":null,"Stores":null,"IncludePreviewInSocialMediaPost":true,"SocialMediaMessage":null,"SocialMediaAccounts":null,"SendNow":true,"CancelAvailable":false,"IsFinalized":false}; 
    var getDetailsFalse = {"Id":57214,"DesignId":5225,"LayoutId":1,"Name":"test","Subject":null,"From":"Wilson","ReusableCouponCode":null,"HasRedeemContentBlock":false,"Html":"<html xmlns:Indy=\"urn:indy-scripts\"><head><META http-equiv=\"Content-Type\" content=\"text/html; charset=us-ascii\"></head><body bgcolor=\"#FFFFFF\"><br />\r\n<style type=\"text/css\" media=\"all\">\r\n    .ExternalClass { width:100%; text-align:center !important; }\r\n</style><div class=\"outerWrapper\" align=\"center\"><table width=\"600\"><tr><td style=\"font-size:11px;font-family:Verdana;padding-bottom:3px;text-align:right;\"><a style=\"color:#000000;\" href=\"##_onlineversion('StoreCode')_##\">View Online</a></td></tr></table><table width=\"600\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\"><tr><td><IMG SRC=\"/Images/Designs/00005225/1.jpg?e=2070947327\" ALT=\"\" WIDTH=\"600\" HEIGHT=\"175\" BORDER=\"0\"></td></tr><tr><td bgcolor=\"#FFDF96\" width=\"600\" height=\"20\" align=\"left\"><table width=\"95%\" align=\"center\" class=\"layoutTable\"><tbody><tr class=\"editorContentBlock\"><td style=\"padding-top: 10px; padding-bottom: 10px;\"><div editable=\"true\" class=\"editor-default-value align\" image-editor=\"true\" style=\"margin:0px auto;float:none;\"><img data-align-enabled=\"true\" width=\"560\" height=\"112\" data-file-width=\"776\" data-file-height=\"156\" data-file-id=\"0\" src=\"/Images/LayoutPreviews/imageblockdefault.jpg\" style=\"max-width:100%;\"></div></td></tr><tr class=\"editorContentBlock\"><td style=\"padding-top: 10px; padding-bottom: 10px;\"><table><tr><td><div editable=\"true\" class=\"editor-default-value imageEditorBlock\" image-editor=\"true\" style=\"float:left; zoom:1; width:184px; height:81px;padding-top:10px;\"><img vspace=\"10\" hspace=\"20\" width=\"184\" height=\"81\" data-file-width=\"184\" data-file-height=\"81\" data-file-id=\"0\" src=\"/Images/LayoutPreviews/imageblocksmalldefault.jpg\" align=\"left\"></div><div data-contenteditable=\"true\" editable=\"true\" class=\"editor-default-value\" text-editor=\"true\" style=\"font-family:Arial, Helvetica, sans-serif; font-size:11pt; \"><p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aliquam, magni natus voluptas vero sit nesciunt consequatur eveniet iure tempora ex! Quas iure mollitia aut aspernatur. Voluptas non harum reiciendis vel? Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci, nobis, at, accusamus cumque sit laboriosam non voluptatibus totam iste fugit earum harum nam voluptates officiis et laudantium rem dolorem minus!</p></div></td></tr></table></td></tr><tr class=\"editorContentBlock\"><td style=\"padding-top: 10px; padding-bottom: 10px;\"><table><tr><td><div editable=\"true\" class=\"editor-default-value imageEditorBlock\" image-editor=\"true\" style=\"float:left; zoom:1; width:184px; height:81px;padding-top:10px;\"><img vspace=\"10\" hspace=\"20\" width=\"184\" height=\"81\" data-file-width=\"184\" data-file-height=\"81\" data-file-id=\"0\" src=\"/Images/LayoutPreviews/imageblocksmalldefault.jpg\" align=\"left\"></div><div data-contenteditable=\"true\" editable=\"true\" class=\"editor-default-value\" text-editor=\"true\" style=\"font-family:Arial, Helvetica, sans-serif; font-size:11pt; \"><p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aliquam, magni natus voluptas vero sit nesciunt consequatur eveniet iure tempora ex! Quas iure mollitia aut aspernatur. Voluptas non harum reiciendis vel? Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci, nobis, at, accusamus cumque sit laboriosam non voluptatibus totam iste fugit earum harum nam voluptates officiis et laudantium rem dolorem minus!</p></div></td></tr></table></td></tr><tr class=\"editorContentBlock\"><td style=\"padding-top: 10px; padding-bottom: 10px;\"><table><tr><td><div editable=\"true\" class=\"editor-default-value imageEditorBlock\" image-editor=\"true\" style=\"float:left; zoom:1; width:184px; height:81px;padding-top:10px;\"><img vspace=\"10\" hspace=\"20\" width=\"184\" height=\"81\" data-file-width=\"184\" data-file-height=\"81\" data-file-id=\"0\" src=\"/Images/LayoutPreviews/imageblocksmalldefault.jpg\" align=\"left\"></div><div data-contenteditable=\"true\" editable=\"true\" class=\"editor-default-value\" text-editor=\"true\" style=\"font-family:Arial, Helvetica, sans-serif; font-size:11pt; \"><p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aliquam, magni natus voluptas vero sit nesciunt consequatur eveniet iure tempora ex! Quas iure mollitia aut aspernatur. Voluptas non harum reiciendis vel? Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci, nobis, at, accusamus cumque sit laboriosam non voluptatibus totam iste fugit earum harum nam voluptates officiis et laudantium rem dolorem minus!</p></div></td></tr></table></td></tr></tbody></table></td></tr><tr><td><IMG SRC=\"/Images/Designs/00005225/3.jpg?e=2070947327\" ALT=\"\" WIDTH=\"600\" HEIGHT=\"92\" BORDER=\"0\"></td></tr></table><table width=\"600\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\"><tr><td colspan=\"3\"><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\"><tr><td align=\"center\"></td><td></td></tr></table></td></tr><tr><td colspan=\"3\"><br><table width=\"100%\" border=\"0\"><tr><td align=\"center\" NOWRAP><style type=\"text/css\">\r\n                    a:link {color: #000000}     /* unvisited link */\r\n                    a:visited {color: #000000}  /* visited link */\r\n                    a:hover {color: #000000}   /* mouse over link */\r\n                    a:active {color: #000000}\r\n                </style><a href=\"/Unsubscribe?Member=00000000000000000000000000000000\"><span style=\"background-color: #ffffff; font-style: normal; font-variant: normal; font-weight: normal; font-size: 11px; line-height: normal; text-decoration: underline; font-family: Verdana; color: #000000;\">Unsubscribe</span></a>\n<span style=\"text-decoration: none;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <a href=\"/UpdateProfile?Member=00000000000000000000000000000000\"><span style=\"color:#000000; background-color:#FFFFFF;font: 11px Verdana;text-decoration:underline;\">Update Your Profile</span></a>\r\n<span style='text-decoration:none;'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> </td></tr><tr><td><hr noshade width=\"100%\" style=\"margin:0px\"></td></tr></table><table cellpadding=\"10\"><tr><td valign=\"top\"><img src=\"http://www.fishbowl.com/poweredby.gif\"></td><td align=\"left\"><DIV style=\"font-family:Arial, Helvetica, sans-serif; font-size:7pt; \">This email was sent because you joined our email club while visiting one of our establishments or through our website. Your email address will not be shared with anyone. You can take your name out of the email club at any time by clicking the unsubscribe link in this email and you will be removed from our list immediately. You joined our list using . Roberto's Pizzeria Bar & Grill, 138 Fisherman's Cove, Miramar Beach, FL 32550 </DIV></td></tr></table></td></tr></table></div><style type=\"text/css\">\r\n                #outerWrapper a:link { color:Black;  } #outerWrapper a:visited {color:Black; } #outerWrapper a:hover { color:Black; } #outerWrapper a:active { color:Black; }\r\n            </style></body></html>","Date":null,"Time":null,"List":null,"GuestCodes":null,"Stores":null,"IncludePreviewInSocialMediaPost":false,"SocialMediaMessage":null,"SocialMediaAccounts":null,"SendNow":false,"CancelAvailable":false,"IsFinalized":false};

    if(req.method === 'post'){
        //read header to determine if put or post
        var methodOverride = req.headers['X-HTTP-METHOD-OVERRIDE'];
        if(methodOverride === 'PUT'){
            res.send(updateNoSchedule);
        }
        else{
            res.send(previewFalseCopyFalse);
        }

    }
    else{
        res.send(getDetailsFalse);   
    }
   res.end();
});

app.use('/api/layouts', function(req, res, next){
    var response = [{"id":1,"name":"NewEditorLayout","thumbnailUrl":"/Images/LayoutPreviews/NewEditorPreview.jpg"}];
    res.send(response);
    res.end();
});

app.use('/api/contentblocks', function(req, res, next){
    var response = [{"id":1,"thumbnailUrl":"/Images/ContentBlocks/textblockpreview.jpg","description":"Layout TextBlock","name":"TextBlock","html":"<tr class=\"editorContentBlock\"><td editable=\"true\" class=\"editor-default-value\" text-editor=\"true\" style=\"padding-top: 10px; padding-bottom: 10px;\"><div data-contenteditable=\"true\" style=\"font-family:Arial, Helvetica, sans-serif; font-size:11pt; \"><p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aliquam, magni natus voluptas vero sit nesciunt consequatur eveniet iure tempora ex! Quas iure mollitia aut aspernatur. Voluptas non harum reiciendis vel? Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci, nobis, at, accusamus cumque sit laboriosam non voluptatibus totam iste fugit earum harum nam voluptates officiis et laudantium rem dolorem minus!</p></div></td></tr>"},
        {"id":2,"thumbnailUrl":"/Images/ContentBlocks/imageblockpreview.jpg","description":"Layout ImageBlock","name":"ImageBlock","html":"<tr class=\"editorContentBlock\"><td style=\"padding-top: 10px; padding-bottom: 10px;\"><div editable=\"true\" class=\"editor-default-value align\" image-editor=\"true\" style=\"margin:0px auto;float:none;\"><img data-align-enabled=\"true\" width=\"560\" height=\"112\" data-file-width=\"776\" data-file-height=\"156\" data-file-id=\"0\" src=\"/Images/LayoutPreviews/imageblockdefault.jpg\" style=\"max-width:100%;\" /></div></td></tr>"},
        {"id":3,"thumbnailUrl":"/Images/ContentBlocks/textimageblockpreview.jpg","description":"Layout TextImageBlock","name":"TextImageBlock","html":"<tr class=\"editorContentBlock\"><td style=\"padding-top: 10px; padding-bottom: 10px;\"><table><tr><td><div editable=\"true\" class=\"editor-default-value imageEditorBlock\" image-editor=\"true\" style=\"float:left; zoom:1; width:184px; height:81px;padding-top:10px;\"><img vspace=\"10\" hspace=\"20\" width=\"184\" height=\"81\" data-file-width=\"184\" data-file-height=\"81\" data-file-id=\"0\" src=\"/Images/LayoutPreviews/imageblocksmalldefault.jpg\" align=\"left\" /></div><div data-contenteditable=\"true\" editable=\"true\" class=\"editor-default-value\" text-editor=\"true\" style=\"font-family:Arial, Helvetica, sans-serif; font-size:11pt; \"><p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aliquam, magni natus voluptas vero sit nesciunt consequatur eveniet iure tempora ex! Quas iure mollitia aut aspernatur. Voluptas non harum reiciendis vel? Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci, nobis, at, accusamus cumque sit laboriosam non voluptatibus totam iste fugit earum harum nam voluptates officiis et laudantium rem dolorem minus!</p></div></td></tr></table></td></tr>"},
        {"id":7,"thumbnailUrl":"/Images/ContentBlocks/imagetoprighttextaround.jpg","description":"Image Top Right Text Around Content Block","name":"ImageTopRightTextAround","html":"<tr class=\"editorContentBlock\"><td style=\"padding-top: 10px; padding-bottom: 10px;\"><table><tr><td><div editable=\"true\" class=\"editor-default-value imageEditorBlock\" image-editor=\"true\" style=\"float:right; width:184px; height:81px; padding-top:10px;\"><img vspace=\"10\" hspace=\"20\" width=\"184\" height=\"81\" data-file-width=\"184\" data-file-height=\"81\" data-file-id=\"0\" src=\"/Images/LayoutPreviews/imageblocksmalldefault.jpg\" data-max-width=\"505.8\" align=\"right\" /></div><div data-contenteditable=\"true\" editable=\"true\" class=\"editor-default-value\" text-editor=\"true\" style=\"font-family:Arial, Helvetica, sans-serif; font-size:11pt; \"><p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aliquam, magni natus voluptas vero sit nesciunt consequatur eveniet iure tempora ex! Quas iure mollitia aut aspernatur. Voluptas non harum reiciendis vel? Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci, nobis, at, accusamus cumque sit laboriosam non voluptatibus totam iste fugit earum harum nam voluptates officiis et laudantium rem dolorem minus!</p></div></td></tr></table></td></tr>"},
        {"id":8,"thumbnailUrl":"/Images/ContentBlocks/dividerblockpreview.jpg","description":"Divider Content Block","name":"DividerBlock","html":"<tr class=\"editorContentBlock\"><td divider-editor editable style=\"padding-top: 10px; padding-bottom: 10px;\"><p style=\"margin: 10px 0px; border-top: 1px solid #CCCCCC;text-align:center; font-size:1px;\">&nbsp;</p></td></tr>"},
        {"id":9,"thumbnailUrl":"/Images/ContentBlocks/redeemButtonPreview.jpg","description":"Redeem Button Block","name":"RedeemButtonBlock","html":"<tr class=\"editorContentBlock\" data-no-duplicate=\"redeem\"><td redeem-button-editor editable align=\"center\">\r\n    <table style=\"border-width:0px;border-collapse:collapse;border-spacing:0px;\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\" width=\"480\">\r\n    <tr>\r\n        <td style=\"text-align:left;vertical-align:top;width:17px;padding:0px;\"><img src=\"/Images/ContentBlocks/corner_tl.png\" alt=\"0\" border=\"0\" height=\"17\" width=\"17\" /></td>\r\n        <td style=\"background-color:#FFFFFF;width:450px;padding:0px;\"></td>\r\n        <td style=\"text-align:right;vertical-align:top;width:17px;padding:0px;\"><img src=\"/Images/ContentBlocks/corner_tr.png\" alt=\"0\" border=\"0\" height=\"17\" width=\"17\" /></td>\r\n    </tr>\r\n    <tr>\r\n        <td colspan=\"3\" style=\"font-size:9pt;font-family:'Lucida Sans Unicode', Verdana, Arial;text-align:center;width:100%;padding:0px;background-color:#FFFFFF;\">\r\n            <h4 style=\"font-weight:normal;\">PRESENT THIS EMAIL TO YOUR WAIT STAFF</h4>\r\n            <div id=\"buttonWrapper\">\r\n                <a id=\"redeemButtonLink\" friendlyName=\"Tap to Redeem\" href=\"http://##Site.DomainName##/Redeem/redeems?offerid={offerId}&memberid=##MemberID##\" target=\"_blank\" style=\"background-color:#c4c4c4;border-radius:5px;color:#333333;display:inline-block;font-family:Arial,sans-serif;font-size:14px;font-weight:bold;line-height:40px;text-align:center;text-decoration:none;width:200px;-webkit-text-size-adjust:none;\">WAIT STAFF CLICK HERE</a>\r\n            </div>\r\n            <br />\r\n            (OFFER CODE: <img id=\"couponCode\" src=\"/Images/ContentBlocks/CouponCode.png\" alt=\"\" style=\"display:inline;\" />)\r\n            <br />\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td style=\"text-align:left;vertical-align:bottom;width:17px;padding:0px;\"><img src=\"/Images/ContentBlocks/corner_ll.png\" alt=\"0\" style=\"border:0px;\" border=\"0\" height=\"17\" width=\"17\" /></td>\r\n        <td style=\"background-color:#FFFFFF;width:450px;padding:0px;\"></td>\r\n        <td style=\"text-align:right;vertical-align:bottom;width:17px;padding:0px;\"><img src=\"/Images/ContentBlocks/corner_lr.png\" alt=\"0\" style=\"border:0px;\" border=\"0\" height=\"17\" width=\"17\" /></td>\r\n    </tr>\r\n</table>\r\n    </td></tr>"}];
    res.send(response);
    res.end();
});

app.use(favicon());
app.use(logger('dev'));
app.use(bodyParser.json());
app.use(bodyParser.urlencoded());
app.use(cookieParser());
app.use(express.static(path.join(__dirname, 'public')));


app.use('/', routes);
app.use('/users', users);

/// catch 404 and forwarding to error handler
app.use(function(req, res, next) {
    var err = new Error('Not Found');
    err.status = 404;
    next(err);
});

/// error handlers

// development error handler
// will print stacktrace
if (app.get('env') === 'development') {
    app.use(function(err, req, res, next) {
        res.status(err.status || 500);
        res.render('error', {
            message: err.message,
            error: err
        });
    });
}

// production error handler
// no stacktraces leaked to user
app.use(function(err, req, res, next) {
    res.status(err.status || 500);
    res.render('error', {
        message: err.message,
        error: {}
    });
});

module.exports = app;
